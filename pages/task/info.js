require("../../common/manifest.js");
require("../../common/vendor.js");
global.webpackJsonp([11],{48:function(t,e,a){"use strict";var i=o(a(2)),s=o(a(49));function o(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(s.default))},49:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(51),s=a.n(i),o=a(52),n=!1;var c=function(t){n||a(50)},l=a(0)(s.a,o.a,c,null,null);l.options.__file="..\\..\\..\\..\\data\\work\\ShareChat\\uniapp\\pages\\task\\info.vue",l.esModule&&Object.keys(l.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),l.options.functional&&console.error("[vue-loader] info.vue: functional components are not supported with templates, they should use render functions."),e.default=l.exports},50:function(t,e){},51:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=a(3);e.default={data:function(){return{info:{creator:{}},page:0,page_size:10,pagination:{},task_id:null,updatedTime:0,name:"axcecd@qq.com",style:{pageHeight:0,contentViewHeight:0,footViewHeight:90,mitemHeight:0},scrollTop:0,old:{scrollTop:0},messages:[],comment_textarea_value:"",group_id:null,commentPopupShow:!1,commentPopupID:null,commentPopupData:{}}},onLoad:function(e){this.task_id=e.id;var a=t.getSystemInfoSync();this.style.pageHeight=a.windowHeight,this.style.contentViewHeight=a.windowHeight-t.getSystemInfoSync().screenWidth/750*100,this.reloadPageData()},onShow:function(){},computed:(0,i.mapState)(["forcedLogin","hasLogin","userInfo"]),methods:{reloadPageData:function(){this.resetPageData(),this.fetchServerData(),this.fetchCommentData()},resetPageData:function(){this.info={creator:{}},this.updatedTime=0,this.page=0,this.messages=[]},fetchServerData:function(){var e=this,a=this.app,i={id:this.task_id};a.httpGet("/api/task/info",i,function(i){var s=i.data.data.info;e.info=s,e.updatedTime=a.getNowTime(),a.globalData.taskInfo=e.info,t.setNavigationBarTitle({title:s.title})})},fetchCommentData:function(){var t=this,e=this.app,a=this.task_id,i=this.page+1,s=this.page_size,o={id:a,page:i,page_size:s};e.httpGet("/api/task/comments",o,function(a){var s=a.data.data.pagelist,o=a.data.data.pagination,n=i;n=n<=o.pages?i:i-1,t.messages=t.messages.concat(s),t.pagination=o,t.page=n,t.updatedTime=e.getNowTime()})},actionTask:function(e){var a=this,i=this.app,s=this.task_id,o=e.currentTarget.dataset.action,n=o+"_num",c={id:s,action:o};i.httpPost("/api/task/action",c,function(s){s.data.data.flag?(a.info[n]=a.info[n]+1,i.globalData.taskInfo=a.info):t.showModal({content:"是否要撤回此操作？",success:function(t){t.confirm&&a.actionTaskCancel(e)}})})},actionTaskCancel:function(e){var a=this,i=this.app,s=this.task_id,o=e.currentTarget.dataset.action,n=o+"_num",c={id:s,action:o,cancel:1};i.httpPost("/api/task/action",c,function(e){e.data.data.flag?(a.info[n]=a.info[n]-1,i.globalData.taskInfo=a.info):t.showToast({title:"无需重复操作",icon:"none"})})},scrollToBottom:function(){var e=this,a=t.createSelectorQuery();a.selectAll(".m-item").boundingClientRect(),a.select("#scrollview").boundingClientRect(),a.exec(function(t){e.style.mitemHeight=0,t[0].forEach(function(t){e.style.mitemHeight=e.style.mitemHeight+t.height+20}),e.style.mitemHeight>e.style.contentViewHeight&&(e.scrollTop=e.style.mitemHeight-e.style.contentViewHeight)})},gotoTaskEdit:function(e){if(console.log("gotoTaskEdit",e),this.app.isLogin())if(this.info.creator.id==this.userInfo.id){var a="/pages/task/edit?id="+this.info.id;t.navigateTo({url:a})}else console.log("gotoTaskEdit this.info.creator.id != this.userInfo.id");else console.log("gotoTaskEdit !this.app.isLogin()",e)},bindFormSubmit:function(e){console.log("----bindFormSubmit",e);var a=this.task_id,i=e.detail.value.comment_text;if(i.length<1)t.showToast({title:"请输入评论内容",icon:"none"});else{var s=this,o={id:a,comment:i};this.app.httpPost("/api/task/comment",o,function(t){s.info.comment_num=s.info.comment_num+1;var e=t.data.data.commentinfo;s.messages.push(e),s.comment_textarea_value="",s.scrollToBottom()})}},zanCommentClick:function(e){var a=this.app,i={id:e.id};a.httpPost("/api/task/commentthumbup",i,function(a){a.data.data.flag?e.thumbup_num=e.thumbup_num+1:t.showToast({title:"已点赞过"})})},upper:function(t){this.page=0,this.messages=[],this.fetchCommentData()},lower:function(t){console.log("lower----------",t),this.fetchCommentData()},scroll:function(t){console.log("scroll----------",t),this.old.scrollTop=t.detail.scrollTop},goTop:function(t){this.scrollTop=this.old.scrollTop,this.$nextTick(function(){this.scrollTop=0})},gotoTaskChat:function(e){if(this.group_id)t.navigateTo({url:"/pages/chat/chat?group_id={0}&title={1}".format(this.group_id,this.info.title)});else{var a=this,i={task_id:this.task_id};this.app.httpPost("/api/chat/creategroup",i,function(e){var i=e.data.data.group,s=i.id;a.group_id=s,a.app.setCache(s,i),t.navigateTo({url:"/pages/chat/chat?group_id={0}&title={1}".format(a.group_id,a.info.title)})})}},closeCommentPopup:function(){this.commentPopupShow=!1},showCommentPopup:function(e){this.app.isLogin()?(console.log("showBanner",e),this.commentPopupShow=!0,this.commentPopupID=this.task_id):t.showModal({title:"提醒",content:"需要登陆后才能评论, 是否去登陆?",success:function(e){e.confirm&&t.navigateTo({url:"/pages/user/login"})}})},inputComment:function(t){this.commentPopupData[this.commentPopupID]=t.detail.value},commentTask:function(e){var a=this.commentPopupID,i=this.commentPopupData[a];if(!a|!i)t.showToast({title:"请选择对应任务并写下评论内容",icon:"none"});else{var s=this,o={id:a,comment:i};this.app.httpPost("/api/task/comment",o,function(t){s.info.comment_num=s.info.comment_num+1;var e=t.data.data.commentinfo;s.messages.push(e),s.comment_textarea_value="",s.closeCommentPopup(),s.upper()})}}}}}).call(e,a(1).default)},52:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"page",staticStyle:{width:"100%"}},[a("view",{staticClass:"uni-card"},[a("view",{staticClass:"uni-card-header"},[a("view",{staticClass:"comment_avatar"},[a("image",{attrs:{src:t.info.creator.avatar}})]),a("view",{staticClass:"comment_content_box"},[a("view",{staticClass:"comment_meta"},[a("view",{staticClass:"uni-card-media-text-top"},[a("text",[t._v(t._s(t.info.creator.nickname))])])]),a("view",{staticClass:"uni-card-media-text-bottom"},[t._v("发表于"+t._s(t.info.created))])])]),a("view",{staticClass:"uni-card-content article-content",attrs:{eventid:"7RO-0"},on:{tap:t.gotoTaskEdit}},[a("rich-text",{attrs:{nodes:t.info.content,mpcomid:"q51-0"}}),a("view",{staticClass:"uni-card-media-text-bottom"},[a("text",{staticClass:"uni-card-media-text-bottom"},[t._v("有效期:"+t._s(t.info.stime)+" "+t._s(" ~ ")+" "+t._s(t.info.etime))])])],1),a("view",{staticClass:"uni-card-footer",staticStyle:{"font-size":"36upx"}},[a("view",{staticClass:"uni-card-link",attrs:{"data-action":"thumbup",eventid:"aXc-1"},on:{tap:t.actionTask}},[t._v("\n              点赞"),a("text",{staticClass:"super"},[t._v(t._s(t.info.thumbup_num))])]),a("view",{staticClass:"uni-card-link",attrs:{"data-action":"collect",eventid:"hU2-2"},on:{tap:t.actionTask}},[t._v("\n              收藏"),a("text",{staticClass:"super"},[t._v(t._s(t.info.collect_num))])]),a("view",{staticClass:"uni-card-link",attrs:{"data-action":"follow",eventid:"IEr-3"},on:{tap:t.actionTask}},[t._v("\n              关注"),a("text",{staticClass:"super"},[t._v(t._s(t.info.follow_num))])]),a("view",{staticClass:"uni-card-link",attrs:{"data-action":"comment"}},[t._v("\n              评论"),a("text",{staticClass:"super"},[t._v(t._s(t.info.comment_num))])]),a("view",{staticClass:"uni-card-link",attrs:{"data-action":"browser"}},[t._v("\n              浏览"),a("text",{staticClass:"super"},[t._v(t._s(t.info.browser_num))])]),a("view",{staticClass:"uni-card-link",attrs:{"data-action":"sharing"}},[t._v("\n              分享"),a("text",{staticClass:"super"},[t._v(t._s(t.info.sharing_num))])])])]),t._m(0),a("view",{staticClass:"comment_list_box"},[a("scroll-view",{staticClass:"comment_list_box",attrs:{"scroll-y":"true","scroll-top":t.scrollTop,eventid:"PHz-6"},on:{scrolltoupper:t.upper,scrolltolower:t.lower}},t._l(t.messages,function(e,i){return a("view",{key:e.id,staticClass:"comment_list"},[a("button",{staticClass:"avatar_button",attrs:{bindgetuserinfo:"avatarClicked","open-type":"getUserInfo",lang:"zh_CN"}},[a("view",{staticClass:"comment_avatar"},[a("image",{attrs:{src:e.creator.avatar}})])]),a("view",{staticClass:"comment_total_box"},[a("view",{staticClass:"comment_content_box"},[a("view",{staticClass:"comment_meta"},[a("view",{staticClass:"comment_nickname"},[a("text",[t._v(t._s(e.creator.nickname))]),a("view",{staticClass:"commnet_date"},[a("text",[t._v(t._s(e.created))])])]),a("view",{staticClass:"comment_zan",attrs:{eventid:"RGP-4-"+i},on:{tap:function(a){t.zanCommentClick(e)}}},[e.creator.id==t.userInfo.id?a("image",{attrs:{src:"/static/images/zan_self.png"}}):a("image",{attrs:{src:"/static/images/zan.png"}}),e.thumbup_num>0?a("text",{staticClass:"comment_zan_num"},[t._v(t._s(e.thumbup_num))]):t._e()])]),a("view",{staticClass:"comment_content",attrs:{eventid:"92O-5-"+i},on:{tap:t.commentTextTap,longpress:t.commentLongTap}},[t._v(t._s(e.comment))])])])],1)}))],1),a("view",{staticClass:"add_btn"},[a("button",{staticClass:"btn",attrs:{eventid:"WWf-7"},on:{tap:t.showCommentPopup}},[t._v(" 去评论 ")]),a("button",{staticClass:"btn",attrs:{eventid:"Dbc-8"},on:{tap:t.gotoTaskChat}},[t._v(" 去群聊 ")])],1),t.commentPopupShow?a("view",{staticClass:"grace-banner",staticStyle:{background:"#FFFFFF"},attrs:{catchtouchmove:"move"}},[a("view",{staticStyle:{"justify-content":"flex-end"},attrs:{eventid:"Z4f-9"},on:{tap:t.closeCommentPopup}},[t._m(1)]),a("view",[a("textarea",{staticStyle:{margin:"0 20upx"},attrs:{"data-name":"comment",placeholder:"评论内容, 2~100字",maxlength:"100",eventid:"KqL-10"},on:{input:t.inputComment}})]),a("view",{staticStyle:{padding:"50upx 0","padding-bottom":"68upx"}},[a("button",{staticClass:"mini-btn",staticStyle:{background:"#006600",margin:"0 80upx"},attrs:{type:"warn",eventid:"pL8-11"},on:{tap:t.commentTask}},[t._v("提交评论")])],1)]):t._e(),t.commentPopupShow?a("view",{staticClass:"grace-mask",attrs:{catchtouchmove:"move"}}):t._e()])};i._withStripped=!0;var s={render:i,staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("view",{staticClass:"title_box"},[e("text",[this._v("评论列表")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("view",{staticStyle:{"justify-content":"flex-end","text-align":"right",padding:"20upx"}},[e("text",{staticStyle:{padding:"120upx"}},[this._v("发表评论")]),e("text",{staticClass:"uni-icon uni-icon-close"})])}]};e.a=s}},[48]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/task/info.js.map